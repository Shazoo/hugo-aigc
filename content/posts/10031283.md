+++
title = "Ember.js 和 Ember-Data：当 findAll 加载完所有记录后的回调函数"
slug = "Ember.js 和 Ember-Data：当 findAll 加载完所有记录后的回调函数"
date = "2023-07-24T12:35:11+08:00"
tags = [ "ember.js", "ember-data",]
+++


> 本教程将介绍在使用 Ember-Data 时，如何在 findAll 加载完所有记录后执行回调函数，并提供相应的代码示例。

## 摘要

在 Ember-Data 中，我们可以使用 findAll 方法来加载一个模型的所有记录。但是如何在所有记录加载完成后执行一个回调函数呢？本文将为您提供解决方案和示例代码。

## 内容

下面是一个使用 Ember-Data 的例子，通过自定义适配器来实现 findAll 方法：

```javascript
App.adapter = DS.Adapter.create({
  findAll: function(store, type) {
      var url = type.url;
      jQuery.getJSON(url, function(data) {
          var ids = data.map(function(item, index, self){ return item.id });
          store.loadMany(type, ids, data);
      });
  }
});
```

上述代码中，我们通过 jQuery 的 getJSON 方法获取数据，并使用 loadMany 方法将数据加载到 store 中。

问题是，当每个记录加载完成时会调用 didLoad 方法，但是有没有一种方式可以在所有记录加载完成后调用一个方法呢？

如果您想在所有记录加载完成后执行特定的操作，可以使用 findQuery 方法，并观察 ModelArray 的 .isLoaded 属性。

下面是示例代码：

```javascript
load: function() {
    this.set('data', this.get('store').findQuery(App.MyModel, { q: '...' }));
}
```

你可以使用 findQuery 方法来加载数据，并在 Controller 中观察 .isLoaded 属性。

下面是观察方法的示例：

```javascript
loadingComplete: function() {
    if (this.getPath('data.isLoaded')) {
        this.doSomeStuff();
    }
}.observes('data.isLoaded')
```

通过以上代码，当所有数据加载完成后，会执行 doSomeStuff 方法。

## 总结

通过本教程，我们介绍了在 Ember.js 和 Ember-Data 中，如何在 findAll 加载完所有记录后执行回调函数。您可以通过使用 findQuery 方法并观察 .isLoaded 属性来实现该功能。希望本文对您有所帮助！


